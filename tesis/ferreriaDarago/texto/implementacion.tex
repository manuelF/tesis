\section{Implementaci\'on existente}
\label{implementacion}

Antes de describir las mejoras realizadas sobre la aplicaci\'on existente, vamos a ver
los pasos que componen la construcci\'on de la matriz de Kohn-Sham, necesario para el
c\'alculo de la estructura electr\'onica.

\begin{figure}[htbp]
   \centering
   \includegraphics[width=250px]{images/g2g-steps.pdf}
   \caption{Pasos del c\'alculo de DFT realizado por LIO.}
   \label{fig:lio-steps}
\end{figure}

\begin{figure}[htbp]
   \centering
   \includegraphics[width=100px]{images/grilla.pdf}
   \caption{Esquema del mallado de integracion, partido en cubos y esferas para un sistema de dos \'atomos.}
   \label{fig:grilla}
\end{figure}
%En este trabajo nos vamos a concentrar en los puntos ijk que mas tardan
%Usamos la ecuacion \ref{approx_excenergy} aca
%Para calcular la densidad en cada punto, usamos la \rho^k que esta en cuda
%Hay que traerla aca para escribir la densidad, y explicar porque hacemos agrupamiento
%esto es porque las funciones son gaussianas y no son importantes en todo el espacio (si localmente)
% para cada punto entonces va a habar un grpo de funciones gaussianas que sean significativas,
% en vez de armar una lista para cada punto, si los agrupo espacialmente podes tener una lista que
% englobe a todos los puntos va a tener menor overhead que tener una lista para cada punto

Este esquema esta basado en el trabajo de Stratmann~\cite{Stratmann}, donde se propone
agrupar puntos de la grilla en vez de resolver el computo uno por uno. El agrupamiento permite determinar
cuales funciones tienen una contribuci\'on significativa al computo final. Dado que las
funciones Gaussianas decaen r\'apidamente a la distancia, el tama\~no del conjunto de
funciones significativas no depende del n\'umero de \'atomos del sistema. Es decir, el tama\~no
tiene orden constante en t\'erminos de complejidad computacional. Como consecuencia, es posible
subdividir el c\'alculo de la DFT computando los grupos de puntos de manera independientemente.

Para construir estos grupos se genera un mallado en cubos y esferas que incluya todos los puntos
de la grilla. Como los puntos no se distribuyen homog\'eneamente, sino que la mayor cantidad de ellos
se concentran cerca de los n\'ucleos, si se usara una partici\'on \'unicamente basada en cubos, la cantidad
de puntos contenidos en cada grupo diferir\'ia considerablemente. El uso de grupos esf\'ericos rodeando
los nucleos eliminan zonas de alta concentraci\'on de puntos y permite que los puntos remanentes
tengan una distribuci\'on mas homog\'enea. Este esquema de construcci\'on se muestra en la figura~\ref{fig:grilla}
y el detalle algor\'itmico de la generaci\'on se estudi\'o previamente~\cite{Nitsche2014,TesisNitsche},
sin modificaciones para este trabajo.

Un diagrama simplificando la estructura del c\'alculo de DFT se puede ver en la figura \ref{fig:lio-steps}.
Los pasos (a) a (e) corresponden a la etapa de inicializaci\'on, y se calculan una \'unica vez
al comienzo de la simulaci\'on. La iteraci\'on de SCF (\textit{Self-Consistent Field}) se
compone de los pasos (f) a (l). Este ciclo se repite mientras la matriz densidad cambia
m\'as de una cierta tolerancia previamente establecida.~\cite{Nitsche2014}.

Los pasos de la figura \ref{fig:lio-steps} m\'as computacionalmente costosos son (i), (j) y (k).
En la implementaci\'on original de LIO~\cite{TesisNitsche}, se muestra como estos pasos
obtienen grandes mejoras en GPU sobre su implementaci\'on de referencia en CPU. Sin embargo,
estos pasos todav\'ia insumen una gran cantidad de tiempo, incluso en las versiones aceleradas.

A continuaci\'on se presentan distintos cambios hechos a las rutinas para minimizar los tiempos,
sin cambiar la estructura general del c\'alculo, ya probado en la literatura.

\section{Implementaci\'on en CUDA}

\input{implementacion-cuda}

\section{Implementaci\'on en CPU}

\input{implementacion-cpu}

\section{Implementaci\'on en Xeon Phi}

\input{implementacion-xeon-phi}
